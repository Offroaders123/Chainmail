use crate::{
    convert::convert_to::TryConvertTo,
    schema::{java::v1_20::item as java, pi::v0_1_1::item as pi},
};

impl TryConvertTo<pi::Item> for java::Item {
    fn try_convert(&self) -> Option<pi::Item> {
        let id: pi::ItemResource = self.id.try_convert()?;

        Some(pi::Item {
            id,
            Damage: self.tag.as_ref().map_or(0, |tag| clamp_damage(tag.Damage)),
            Count: self.Count,
        })
    }
}

/// Converts a Java Edition item damage value (`i32`) to a Bedrock Edition-compatible value (`i16`).
///
/// In Java Edition, `Damage` is stored as a 32-bit signed integer. In Bedrock Edition,
/// it is stored as a 16-bit signed integer. To preserve vanilla-compatible behavior,
/// this function clamps the input to the valid `i16` range: -32,768 to 32,767.
///
/// This avoids overflow and wraparound artifacts that could result in undefined behavior
/// or corrupted item states in Bedrock.
///
/// # Parameters
/// - `value`: The Java Edition `Damage` value as `i32`.
///
/// # Returns
/// A clamped `i16` value safe for use in Bedrock Edition NBT.
///
/// # Example
/// ```
/// let bedrock_damage = clamp_damage(40000);
/// assert_eq!(bedrock_damage, 32767);
/// ```
fn clamp_damage(value: i32) -> i16 {
    value.clamp(i16::MIN as i32, i16::MAX as i32) as i16
}

impl TryConvertTo<pi::ItemResource> for java::ItemResource {
    fn try_convert(&self) -> Option<pi::ItemResource> {
        match self {
            Self::acacia_boat => None,
            Self::amethyst_shard => None,
            Self::apple => Some(pi::ItemResource::apple),
            Self::armor_stand => None,
            Self::arrow => Some(pi::ItemResource::arrow),
            Self::axolotl_bucket => None,
            Self::axolotl_spawn_egg => None,
            Self::baked_potato => None,
            Self::bat_spawn_egg => None,
            Self::bee_spawn_egg => None,
            Self::beef => Some(pi::ItemResource::raw_beef),
            Self::beetroot => None,
            Self::beetroot_seeds => None,
            Self::beetroot_soup => None,
            Self::birch_boat => None,
            Self::black_dye => None,
            Self::blaze_powder => None,
            Self::blaze_rod => None,
            Self::blaze_spawn_egg => None,
            Self::blue_dye => None,
            Self::bone => Some(pi::ItemResource::bone),
            Self::bone_meal => None,
            Self::book => Some(pi::ItemResource::book),
            Self::bow => Some(pi::ItemResource::bow),
            Self::bowl => Some(pi::ItemResource::bowl),
            Self::bread => Some(pi::ItemResource::bread),
            Self::brick => Some(pi::ItemResource::clay_brick),
            Self::brown_dye => None,
            Self::bucket => None,
            Self::bundle => None,
            Self::carrot => None,
            Self::carrot_on_a_stick => None,
            Self::cat_spawn_egg => None,
            Self::cave_spider_spawn_egg => None,
            Self::chainmail_boots => Some(pi::ItemResource::chain_boots),
            Self::chainmail_chestplate => Some(pi::ItemResource::chain_chestplate),
            Self::chainmail_helmet => Some(pi::ItemResource::chain_helmet),
            Self::chainmail_leggings => Some(pi::ItemResource::chain_leggings),
            Self::charcoal => None,
            Self::chest_minecart => None,
            Self::chicken => Some(pi::ItemResource::raw_chicken),
            Self::chicken_spawn_egg => None,
            Self::chorus_fruit => None,
            Self::clay_ball => Some(pi::ItemResource::clay),
            Self::clock => Some(pi::ItemResource::clock),
            Self::coal => Some(pi::ItemResource::coal),
            Self::cocoa_beans => None,
            Self::cod => None,
            Self::cod_bucket => None,
            Self::cod_spawn_egg => None,
            Self::command_block_minecart => None,
            Self::compass => Some(pi::ItemResource::compass),
            Self::cooked_beef => Some(pi::ItemResource::steak),
            Self::cooked_chicken => Some(pi::ItemResource::cooked_chicken),
            Self::cooked_cod => None,
            Self::cooked_mutton => None,
            Self::cooked_porkchop => Some(pi::ItemResource::cooked_porkchop),
            Self::cooked_rabbit => None,
            Self::cooked_salmon => None,
            Self::cookie => None,
            Self::copper_ingot => None,
            Self::cow_spawn_egg => None,
            Self::creeper_banner_pattern => None,
            Self::creeper_spawn_egg => None,
            Self::crossbow => None,
            Self::cyan_dye => None,
            Self::dark_oak_boat => None,
            Self::debug_stick => None,
            Self::diamond => Some(pi::ItemResource::diamond),
            Self::diamond_axe => Some(pi::ItemResource::diamond_axe),
            Self::diamond_boots => Some(pi::ItemResource::diamond_boots),
            Self::diamond_chestplate => Some(pi::ItemResource::diamond_chestplate),
            Self::diamond_helmet => Some(pi::ItemResource::diamond_helmet),
            Self::diamond_hoe => Some(pi::ItemResource::diamond_hoe),
            Self::diamond_horse_armor => None,
            Self::diamond_leggings => Some(pi::ItemResource::diamond_leggings),
            Self::diamond_pickaxe => Some(pi::ItemResource::diamond_pickaxe),
            Self::diamond_shovel => Some(pi::ItemResource::diamond_shovel),
            Self::diamond_sword => Some(pi::ItemResource::diamond_sword),
            Self::dolphin_spawn_egg => None,
            Self::donkey_spawn_egg => None,
            Self::dragon_breath => None,
            Self::dried_kelp => None,
            Self::drowned_spawn_egg => None,
            Self::egg => Some(pi::ItemResource::egg),
            Self::elder_guardian_spawn_egg => None,
            Self::elytra => None,
            Self::emerald => None,
            Self::enchanted_book => None,
            Self::enchanted_golden_apple => None,
            Self::end_crystal => None,
            Self::ender_eye => None,
            Self::ender_pearl => None,
            Self::enderman_spawn_egg => None,
            Self::endermite_spawn_egg => None,
            Self::evoker_spawn_egg => None,
            Self::experience_bottle => None,
            Self::feather => Some(pi::ItemResource::feather),
            Self::fermented_spider_eye => None,
            Self::filled_map => None,
            Self::fire_charge => None,
            Self::firework_rocket => None,
            Self::firework_star => None,
            Self::fishing_rod => None,
            Self::flint => Some(pi::ItemResource::flint),
            Self::flint_and_steel => Some(pi::ItemResource::flint_steel),
            Self::flower_banner_pattern => None,
            Self::fox_spawn_egg => None,
            Self::furnace_minecart => None,
            Self::ghast_spawn_egg => None,
            Self::ghast_tear => None,
            Self::glass_bottle => None,
            Self::glistering_melon_slice => None,
            Self::globe_banner_pattern => None,
            Self::glow_berries => None,
            Self::glow_ink_sac => None,
            Self::glow_item_frame => None,
            Self::glow_squid_spawn_egg => None,
            Self::glowstone_dust => Some(pi::ItemResource::glowstone_dust),
            Self::goat_spawn_egg => None,
            Self::gold_ingot => Some(pi::ItemResource::gold_ingot),
            Self::gold_nugget => None,
            Self::golden_apple => None,
            Self::golden_axe => Some(pi::ItemResource::gold_axe),
            Self::golden_boots => Some(pi::ItemResource::gold_boots),
            Self::golden_carrot => None,
            Self::golden_chestplate => Some(pi::ItemResource::gold_chestplate),
            Self::golden_helmet => Some(pi::ItemResource::gold_helmet),
            Self::golden_hoe => Some(pi::ItemResource::gold_hoe),
            Self::golden_horse_armor => None,
            Self::golden_leggings => Some(pi::ItemResource::gold_leggings),
            Self::golden_pickaxe => Some(pi::ItemResource::gold_pickaxe),
            Self::golden_shovel => Some(pi::ItemResource::gold_shovel),
            Self::golden_sword => Some(pi::ItemResource::gold_sword),
            Self::gray_dye => None,
            Self::green_dye => None,
            Self::guardian_spawn_egg => None,
            Self::gunpowder => Some(pi::ItemResource::gunpowder),
            Self::heart_of_the_sea => None,
            Self::hoglin_spawn_egg => None,
            Self::honey_bottle => None,
            Self::honeycomb => None,
            Self::hopper_minecart => None,
            Self::horse_spawn_egg => None,
            Self::husk_spawn_egg => None,
            Self::ink_sac => None,
            Self::iron_axe => Some(pi::ItemResource::iron_axe),
            Self::iron_boots => Some(pi::ItemResource::iron_boots),
            Self::iron_chestplate => Some(pi::ItemResource::iron_chestplate),
            Self::iron_helmet => Some(pi::ItemResource::iron_helmet),
            Self::iron_hoe => Some(pi::ItemResource::iron_hoe),
            Self::iron_horse_armor => None,
            Self::iron_ingot => Some(pi::ItemResource::iron_ingot),
            Self::iron_leggings => Some(pi::ItemResource::iron_leggings),
            Self::iron_nugget => None,
            Self::iron_pickaxe => Some(pi::ItemResource::iron_pickaxe),
            Self::iron_shovel => Some(pi::ItemResource::iron_shovel),
            Self::iron_sword => Some(pi::ItemResource::iron_sword),
            Self::item_frame => None,
            Self::jungle_boat => None,
            Self::knowledge_book => None,
            Self::lapis_lazuli => None,
            Self::lava_bucket => None,
            Self::lead => None,
            Self::leather => Some(pi::ItemResource::leather),
            Self::leather_boots => Some(pi::ItemResource::leather_boots),
            Self::leather_chestplate => Some(pi::ItemResource::leather_tunic),
            Self::leather_helmet => Some(pi::ItemResource::leather_cap),
            Self::leather_horse_armor => None,
            Self::leather_leggings => Some(pi::ItemResource::leather_pants),
            Self::light_blue_dye => None,
            Self::light_gray_dye => None,
            Self::lime_dye => None,
            Self::lingering_potion => None,
            Self::llama_spawn_egg => None,
            Self::magenta_dye => None,
            Self::magma_cream => None,
            Self::magma_cube_spawn_egg => None,
            Self::map => None,
            Self::melon_seeds => Some(pi::ItemResource::melon_seeds),
            Self::melon_slice => Some(pi::ItemResource::melon),
            Self::milk_bucket => None,
            Self::minecart => None,
            Self::mojang_banner_pattern => None,
            Self::mooshroom_spawn_egg => None,
            Self::mule_spawn_egg => None,
            Self::mushroom_stew => Some(pi::ItemResource::mushroom_stew),
            Self::music_disc_5 => None,
            Self::music_disc_11 => None,
            Self::music_disc_13 => None,
            Self::music_disc_blocks => None,
            Self::music_disc_cat => None,
            Self::music_disc_chirp => None,
            Self::music_disc_far => None,
            Self::music_disc_mall => None,
            Self::music_disc_mellohi => None,
            Self::music_disc_otherside => None,
            Self::music_disc_pigstep => None,
            Self::music_disc_relic => None,
            Self::music_disc_stal => None,
            Self::music_disc_strad => None,
            Self::music_disc_wait => None,
            Self::music_disc_ward => None,
            Self::mutton => None,
            Self::name_tag => None,
            Self::nautilus_shell => None,
            Self::nether_brick => Some(pi::ItemResource::nether_brick),
            Self::nether_star => None,
            Self::netherite_axe => None,
            Self::netherite_boots => None,
            Self::netherite_chestplate => None,
            Self::netherite_helmet => None,
            Self::netherite_hoe => None,
            Self::netherite_ingot => None,
            Self::netherite_leggings => None,
            Self::netherite_pickaxe => None,
            Self::netherite_scrap => None,
            Self::netherite_shovel => None,
            Self::netherite_sword => None,
            Self::oak_boat => None,
            Self::ocelot_spawn_egg => None,
            Self::orange_dye => None,
            Self::painting => Some(pi::ItemResource::painting),
            Self::panda_spawn_egg => None,
            Self::paper => Some(pi::ItemResource::paper),
            Self::parrot_spawn_egg => None,
            Self::phantom_membrane => None,
            Self::phantom_spawn_egg => None,
            Self::pig_spawn_egg => None,
            Self::piglin_brute_spawn_egg => None,
            Self::piglin_spawn_egg => None,
            Self::pillager_spawn_egg => None,
            Self::pink_dye => None,
            Self::poisonous_potato => None,
            Self::polar_bear_spawn_egg => None,
            Self::popped_chorus_fruit => None,
            Self::porkchop => Some(pi::ItemResource::raw_porkchop),
            Self::potato => None,
            Self::potion => None,
            Self::powder_snow_bucket => None,
            Self::prismarine_crystals => None,
            Self::prismarine_shard => None,
            Self::pufferfish => None,
            Self::pufferfish_bucket => None,
            Self::pufferfish_spawn_egg => None,
            Self::pumpkin_pie => None,
            Self::pumpkin_seeds => None,
            Self::purple_dye => None,
            Self::quartz => Some(pi::ItemResource::nether_quartz),
            Self::rabbit => None,
            Self::rabbit_foot => None,
            Self::rabbit_hide => None,
            Self::rabbit_spawn_egg => None,
            Self::rabbit_stew => None,
            Self::ravager_spawn_egg => None,
            Self::raw_copper => None,
            Self::raw_gold => None,
            Self::raw_iron => None,
            Self::red_dye => None,
            Self::redstone => None,
            Self::rotten_flesh => None,
            Self::saddle => None,
            Self::salmon => None,
            Self::salmon_bucket => None,
            Self::salmon_spawn_egg => None,
            Self::scute => None,
            Self::shears => Some(pi::ItemResource::shears),
            Self::sheep_spawn_egg => None,
            Self::shield => None,
            Self::shulker_shell => None,
            Self::shulker_spawn_egg => None,
            Self::silverfish_spawn_egg => None,
            Self::skeleton_horse_spawn_egg => None,
            Self::skeleton_spawn_egg => None,
            Self::skull_banner_pattern => None,
            Self::slime_ball => Some(pi::ItemResource::slimeball),
            Self::slime_spawn_egg => None,
            Self::snowball => Some(pi::ItemResource::snowball),
            Self::spectral_arrow => None,
            Self::spider_eye => None,
            Self::spider_spawn_egg => None,
            Self::splash_potion => None,
            Self::spruce_boat => None,
            Self::spyglass => None,
            Self::squid_spawn_egg => None,
            // almost had a type to make this steak, that would have been hilarious!!
            Self::stick => Some(pi::ItemResource::stick),
            Self::stone_axe => Some(pi::ItemResource::stone_axe),
            Self::stone_hoe => Some(pi::ItemResource::stone_hoe),
            Self::stone_pickaxe => Some(pi::ItemResource::stone_pickaxe),
            Self::stone_shovel => Some(pi::ItemResource::stone_shovel),
            Self::stone_sword => Some(pi::ItemResource::stone_sword),
            Self::stray_spawn_egg => None,
            Self::strider_spawn_egg => None,
            Self::string => Some(pi::ItemResource::string),
            Self::sugar => Some(pi::ItemResource::sugar),
            Self::suspicious_stew => None,
            Self::sweet_berries => None,
            Self::tipped_arrow => None,
            Self::tnt_minecart => None,
            Self::totem_of_undying => None,
            Self::trader_llama_spawn_egg => None,
            Self::trident => None,
            Self::tropical_fish => None,
            Self::tropical_fish_bucket => None,
            Self::tropical_fish_spawn_egg => None,
            Self::turtle_helmet => None,
            Self::turtle_spawn_egg => None,
            Self::vex_spawn_egg => None,
            Self::villager_spawn_egg => None,
            Self::vindicator_spawn_egg => None,
            Self::wandering_trader_spawn_egg => None,
            Self::warped_fungus_on_a_stick => None,
            Self::water_bucket => None,
            Self::wheat => Some(pi::ItemResource::wheat),
            Self::wheat_seeds => Some(pi::ItemResource::seeds),
            Self::white_dye => None,
            Self::witch_spawn_egg => None,
            Self::wither_skeleton_spawn_egg => None,
            Self::wolf_spawn_egg => None,
            Self::wooden_axe => Some(pi::ItemResource::wooden_axe),
            Self::wooden_hoe => Some(pi::ItemResource::wooden_hoe),
            Self::wooden_pickaxe => Some(pi::ItemResource::wooden_pickaxe),
            Self::wooden_shovel => Some(pi::ItemResource::wooden_shovel),
            Self::wooden_sword => Some(pi::ItemResource::wooden_sword),
            Self::writable_book => None,
            Self::written_book => None,
            Self::yellow_dye => None,
            Self::zoglin_spawn_egg => None,
            Self::zombie_horse_spawn_egg => None,
            Self::zombie_spawn_egg => None,
            Self::zombie_villager_spawn_egg => None,
            Self::zombified_piglin_spawn_egg => None,
            Self::tadpole_bucket => None,
            Self::disc_fragment_5 => None,
            Self::echo_shard => None,
            Self::goat_horn => None,
            Self::mangrove_boat => None,
            Self::recovery_compass => None,
            Self::allay_spawn_egg => None,
            Self::frog_spawn_egg => None,
            Self::tadpole_spawn_egg => None,
            Self::warden_spawn_egg => None,
            Self::oak_chest_boat => None,
            Self::spruce_chest_boat => None,
            Self::birch_chest_boat => None,
            Self::jungle_chest_boat => None,
            Self::acacia_chest_boat => None,
            Self::dark_oak_chest_boat => None,
            Self::mangrove_chest_boat => None,
            Self::nether_wart => None,
            Self::piglin_banner_pattern => None,
            Self::ender_dragon_spawn_egg => None,
            Self::iron_golem_spawn_egg => None,
            Self::snow_golem_spawn_egg => None,
            Self::wither_spawn_egg => None,
            Self::brush => None,
            Self::pitcher_pod => None,
            Self::angler_pottery_sherd => None,
            Self::archer_pottery_sherd => None,
            Self::arms_up_pottery_sherd => None,
            Self::blade_pottery_sherd => None,
            Self::brewer_pottery_sherd => None,
            Self::burn_pottery_sherd => None,
            Self::danger_pottery_sherd => None,
            Self::explorer_pottery_sherd => None,
            Self::friend_pottery_sherd => None,
            Self::heart_pottery_sherd => None,
            Self::heartbreak_pottery_sherd => None,
            Self::howl_pottery_sherd => None,
            Self::miner_pottery_sherd => None,
            Self::mourner_pottery_sherd => None,
            Self::plenty_pottery_sherd => None,
            Self::prize_pottery_sherd => None,
            Self::sheaf_pottery_sherd => None,
            Self::shelter_pottery_sherd => None,
            Self::skull_pottery_sherd => None,
            Self::snort_pottery_sherd => None,
            Self::netherite_upgrade_smithing_template => None,
            Self::coast_armor_trim_smithing_template => None,
            Self::dune_armor_trim_smithing_template => None,
            Self::eye_armor_trim_smithing_template => None,
            Self::host_armor_trim_smithing_template => None,
            Self::raiser_armor_trim_smithing_template => None,
            Self::rib_armor_trim_smithing_template => None,
            Self::sentry_armor_trim_smithing_template => None,
            Self::shaper_armor_trim_smithing_template => None,
            Self::silence_armor_trim_smithing_template => None,
            Self::snout_armor_trim_smithing_template => None,
            Self::spire_armor_trim_smithing_template => None,
            Self::tide_armor_trim_smithing_template => None,
            Self::vex_armor_trim_smithing_template => None,
            Self::ward_armor_trim_smithing_template => None,
            Self::wayfinder_armor_trim_smithing_template => None,
            Self::wild_armor_trim_smithing_template => None,
            Self::camel_spawn_egg => None,
            Self::sniffer_spawn_egg => None,
            Self::torchflower_seeds => None,
        }
    }
}
